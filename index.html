<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>门锁电池电压电量关系计算</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
            --card-bg: rgba(255, 255, 255, 0.95);
            --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            --main-bg: linear-gradient(135deg, #e6f7ff, #f0f9ff);
            --lithium-active: linear-gradient(90deg, #3b82f6, #1d4ed8);
            --drycell-active: linear-gradient(90deg, #f59e0b, #ea580c);
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a, #1e293b);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* 新增：两栏布局 */
        .two-column-layout {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        /* 左侧项目列表 - 固定宽度 */
        .projects-panel {
            flex: 0 0 350px; /* 固定宽度，不伸缩 */
            width: 350px; /* 明确设置宽度 */
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .projects-header {
            background: linear-gradient(90deg, #1a56db, #1e40af);
            color: white;
            padding: 20px;
        }
        
        .projects-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .projects-list {
            padding: 15px;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }
        
        /* 树形结构样式 */
        .tree-view {
            list-style: none;
            padding-left: 0;
        }
        
        .tree-item {
            margin-bottom: 5px;
        }
        
        .tree-header {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background: linear-gradient(90deg, var(--light), #dbeafe);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tree-header:hover {
            background: #dbeafe;
        }
        
        .tree-header i {
            margin-right: 10px;
            transition: transform 0.3s ease;
        }
        
        .tree-header.expanded i {
            transform: rotate(90deg);
        }
        
        .tree-content {
            padding-left: 30px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .tree-content.expanded {
            max-height: 500px;
        }

        .project-item {
            padding: 15px;
            margin-bottom: 10px;
            background: #e0f2fe;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .project-item:hover {
            background: #bae6fd;
            transform: translateX(5px);
        }
        
        .project-item.active {
            background: linear-gradient(90deg, #1a56db, #1e40af);
            color: white;
        }
        
        .project-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-blue {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .badge-purple {
            background: #ede9fe;
            color: #5b21b6;
        }
        
        .badge-green {
            background: #dcfce7;
            color: #166534;
        }
        
        /* 右侧内容区域 */
        .content-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* 调整原有样式适应新布局 */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        
        .card-header {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px 25px;
        }
        
        .card-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .card-header h2 i {
            font-size: 1.4rem;
        }
        
        .item-list {
            list-style: none;
        }
        
        .item {
            padding: 12px 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition:  0.3s ease;
        }
        
        .item:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        header {
            text-align: center;
            padding: 25px 0;
            margin-bottom: 20px;
            color: #374151;
        }
        header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            color: #1e40af;
            margin-bottom: 10px;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: fadeIn 0.6s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 15px 10px -6px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px 25px;
        }
        
        .card-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .card-header h2 i {
            font-size: 1.4rem;
        }
        
        .card-body {
            padding: 25px;
        }

        .battery-switch {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .battery-button {
            padding: 14px 35px;
            font-size: 18px;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.8);
            color: #374151;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .battery-button.active {
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 5px 20px rgba(59, 130, 246, 0.3);
        }
        
        #lithiumButton.active {
            background: var(--lithium-active);
        }
        
        #dryCellButton.active {
            background: var(--drycell-active);
        }
        
        .battery-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.15);
        }
        
        .app-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            min-width: 1000px;
            margin: 0 auto;
        }
        
        /* 修改右侧卡片宽度为800px */
        .chart-container {
            flex: 1;
            min-width: 1000px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            padding: 25px;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.6s ease;
        }
        
        .header {
            text-align: center;
            padding: 25px 0;
            margin-bottom: 20px;
            color: #374151;
        }
        
        /* 增大图表显示区域 */
        .chart-wrapper {
            flex: 1;
            min-height: 800px;
            position: relative;
        }
        
        .chart-input-group {
            margin-top: 25px;
            background: #e0f2fe;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .chart-input-group label {
            font-size: 18px;
            font-weight: 600;
            color: #1e40af;
        }
        
        .chart-input-group input {
            padding: 12px 15px;
            font-size: 18px;
            border: 2px solid #bfdbfe;
            border-radius: 10px;
            width: 150px;
            color: #1e40af;
            font-weight: 600;
        }
        
        .chart-input-group input:focus {
            outline: none;
            border-color: #1e40af;
            box-shadow: 0 0 8px rgba(30, 64, 175, 0.3);
        }
        
        .chart-result {
            font-size: 20px;
            font-weight: 600;
            color: #166534;
            margin-left: auto;
        }
        
        /* 修改左侧卡片宽度为700px */
        .monitor-container {
            flex: 1;
            min-width: 850px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(90deg, #1a56db, #1e40af);
            color: white;
            padding: 20px;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        
        .header p {
            opacity: 0.85;
        }
        
        .card-body {
            padding: 25px;
        }
        
        .voltage-display {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            background: #e0f2fe;
            border-radius: 15px;
            padding: 15px;
        }
        
        .voltage-label {
            font-size: 18px;
            font-weight: 600;
            color: #1e40af;
            margin-right: 15px;
        }
        
        .voltage-input {
            padding: 12px 15px;
            font-size: 18px;
            border: 2px solid #bfdbfe;
            border-radius: 10px;
            width: 120px;
            color: #1e40af;
            font-weight: 600;
        }
        
        .voltage-input:focus {
            outline: none;
            border-color: #1e40af;
            box-shadow: 0 0 8px rgba(30, 64, 175, 0.3);
        }
        
        .percent-input {
            padding: 12px 15px;
            font-size: 18px;
            border: 2px solid #bfdbfe;
            border-radius: 10px;
            width: 120px;
            color: #1e40af;
            font-weight: 600;
        }
        
        .percent-input:focus {
            outline: none;
            border-color: #1e40af;
            box-shadow: 0 0 8px rgba(30, 64, 175, 0.3);
        }
        
        .battery-display {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #f8fafc;
            border-radius: 15px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
        }
        
        .battery-label {
            font-size: 18px;
            color: #3b82f6;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .battery-percentage {
            font-size: 70px;
            font-weight: 800;
            transition: color 0.3s;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .battery-low { color: #dc2626; }
        .battery-medium { color: #ea580c; }
        .battery-high { color: #16a34a; }
        
        .battery-visual {
            width: 200px;
            height: 100px;
            border: 3px solid #4b5563;
            border-radius: 15px;
            position: relative;
            margin: 0 auto;
            overflow: hidden;
            background: #f9fafb;
        }
        
        .battery-level {
            height: 100%;
            transition: width 0.5s, background 0.5s;
        }
        
        .battery-cap {
            position: absolute;
            top: 30px;
            right: -15px;
            width: 15px;
            height: 40px;
            background: #4b5563;
            border-radius: 0 5px 5px 0;
        }
        
        .slider-container {
            margin: 30px 0;
            padding: 0 15px;
        }
        
        .slider-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #1e40af;
            font-weight: 600;
        }
        
        .custom-slider {
            width: 100%;
            height: 30px;
            position: relative;
            margin: 30px 0 40px;
        }
        
        .slider-track {
            height: 8px;
            background: #bfdbfe;
            border-radius: 4px;
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            transform: translateY(-50%);
            overflow: visible;
        }
        
        .slider-progress {
            height: 100%;
            background: #1e40af;
            border-radius: 4px;
            transition: width 0.2s;
        }
        
        .slider-handle {
            width: 26px;
            height: 26px;
            background: #1e40af;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            z-index: 10;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .slider-handle:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }
        
        .slider-handle.dragging {
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 0 0 0 4px rgba(30, 64, 175, 0.3);
        }
        
        .slider-marks {
            position: absolute;
            top: 25px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
        }
        
        .slider-mark {
            position: absolute;
            text-align: center;
            font-size: 12px;
            font-weight: 500;
            color: #1e40af;
            transform: translateX(-50%);
        }
        
        .mark-line {
            width: 2px;
            height: 12px;
            background: #1e40af;
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            background: #e0f2fe;
            padding: 15px;
            border-radius: 15px;
            margin-top: 20px;
        }
        
        .status-item {
            text-align: center;
            flex: 1;
        }
        
        .status-title {
            font-size: 14px;
            color: #3b82f6;
            margin-bottom: 5px;
        }
        
        .status-value {
            font-size: 18px;
            font-weight: 600;
            color: #1e40af;
        }

        .status-value:hover {
            color: #3b82f6;
            text-decoration: underline;
        }

        
        .voltage-map {
            margin-top: 30px;
            padding: 15px;
            background: #e0f2fe;
            border-radius: 15px;
        }
        
        .voltage-map h3 {
            text-align: center;
            color: #1e40af;
            margin-bottom: 15px;
        }
        
        .voltage-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        /* 表头样式 */
        .voltage-table th {
            background-color: #1e40af;
            color: white;
            text-align: center;
            padding: 10px;
        }

        /* 单元格样式 */
        .voltage-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #bfdbfe;
        }

        /* 行底部边框 */
        .voltage-table tr {
            border-bottom: 1px solid #e0f2fe;
        }
        
        .footer {
            text-align: center;
            padding: 15px;
            color: #3b82f6;
            font-size: 14px;
            background: rgba(224, 242, 254, 0.7);
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-low { background-color: #dc2626; }
        .status-medium { background-color: #f59e0b; }
        .status-high { background-color: #16a34a; }
        
        /* 添加图表工具提示样式 */
        .chart-tooltip {
            position: absolute;
            display: none;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            pointer-events: none;
            z-index: 100;
            transition: all 0.1s ease;
            font-size: 14px;
            line-height: 1.4;
            min-width: 120px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .chart-tooltip:after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 5px solid rgba(0, 0, 0, 0.8);
        }
        
        .tooltip {
            position: fixed;
            z-index: 1000;
            transition: all 0.2s ease-in-out;
            opacity: 0;
            visibility: hidden;
            transform: translate(0, 0);
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            padding: 10px;
            max-width: 400px;
        }

        .tooltip.active {
            opacity: 1;
            visibility: visible;
            transform: translate(0, 0);
        }

        .tooltip img {
            min-width: 10px;
            min-height: 20px;
            max-width: 440px;
            max-height: 760px;
            object-fit: contain;
            border-radius: 6px;
            display: block;
        }
        
        .tooltip .loading {
            padding: 30px;
            text-align: center;
            color: #6c757d;
        }

        .tooltip .error {
            padding: 20px;
            text-align: center;
            color: #dc2626;
        }



        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 1600px) {
            .app-container {
                flex-direction: column;
            }
            
            .chart-container, .monitor-container {
                width: 100%;
                min-width: auto;
            }
        }
        
        @media (max-width: 1200px) {
            .two-column-layout {
                flex-direction: column;
            }
            
            .projects-panel {
                flex: 0 0 auto;
                width: 100%;
                margin-bottom: 20px;
            }
        }
        
        @media (max-width: 800px) {
            .voltage-display {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .voltage-label {
                margin-bottom: 10px;
            }
            
            .battery-percentage {
                font-size: 55px;
            }
            
            .battery-switch {
                flex-direction: column;
                gap: 10px;
            }
            
            .battery-button {
                width: 100%;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 15px;
            }
            
            .status-item {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>

    <!-- 两栏布局 -->
    <div class="two-column-layout">
        <!-- 左侧项目列表 -->
        <div class="projects-panel">
            <div class="projects-header">
                <h2><i class="fas fa-microchip"></i> 项目分类</h2>
            </div>
            <div class="projects-list">

                <!-- 树形结构 -->
                <ul class="tree-view">
                    <!-- 电池型号 C0963B2 -->
                    <li class="tree-item">
                        <div class="tree-header expanded">
                            <i class="fas fa-caret-right"></i>
                            <span>电池型号: C0963B2</span>
                            <span id="batteryModel1Pic" class="project-badge badge-blue">5000mAh</span>
                        </div>

                        <div class="tree-content expanded">
                            <div class="project-item active" data-project="m4prodan">
                                <span>小米智能门锁4 Pro(单摄)</span>
                                <span class="project-badge badge-green">鹿客</span>
                            </div>

                            <div class="project-item" data-project="m30">
                                <span>小米智能门锁M30</span>
                                <span class="project-badge badge-purple">欧菲</span>
                            </div>

                        </div>
                    </li>
                    
                    <!-- 电池型号 C0963B1 -->
                    <li class="tree-item">
                        <div class="tree-header expanded">
                            <i class="fas fa-caret-right"></i>
                            <span>电池型号: C0963B1</span>
                            <span id="batteryModel2Pic" class="project-badge badge-blue">6870mAh</span>
                        </div>

                        <div class="tree-content expanded">
                            <div class="project-item" data-project="m4proshuang">
                                <span>小米智能门锁4 Pro(双摄)</span>
                                <span class="project-badge badge-green">鹿客</span>
                            </div>
                        </div>
                    </li>
                    
                    <!-- 电池型号 JY745490 -->
                    <li class="tree-item">
                        <div class="tree-header expanded">
                            <i class="fas fa-caret-right"></i>
                            <span>电池型号: JY745490</span>
                            <span id="batteryModel3Pic" class="project-badge badge-blue">8000mAh</span>
                        </div>
                        <div class="tree-content expanded">
                            <div class="project-item" data-project="m5max">
                                <span>小米智能门锁5 MAX全景鱼眼</span>
                                <span class="project-badge badge-purple">欧菲</span>
                            </div>

                            <div class="project-item" data-project="m40">
                                <span>小米智能门锁M40</span>
                                <span class="project-badge badge-purple">欧菲</span>
                            </div>
                        </div>


                    </li>
                </ul>
            </div>
        </div>

        <!-- 右侧内容区域 -->
        <div class="content-panel">
            <div class="projects-header">
                <h2><i class="fas fa-battery-full"></i> 门锁电池电压-电量关系计算
                    <a class="project-badge badge-blue" target="_blank" href="https://xiaomi.f.mioffice.cn/drive/folder/Ui3dfwgRWlfMOTd8PGEkpbPJ4Ic">(服务器路径)</a>
                </h2>
            </div>
            

            <!-- 电池类型切换按钮 -->
            <div class="battery-switch">
                <button id="lithiumButton" class="battery-button active">
                    <i class="fas fa-bolt"></i> 锂电池
                </button>
                <button id="dryCellButton" class="battery-button">
                    <i class="fas fa-battery-full"></i> 干电池
                </button>
            </div>
            
            <div class="app-container">
                <!-- 左侧：电池监控面板 -->
                <div class="card monitor-container">
                    <div class="card-header">
                        <h2 id = "monitor_title" class="fas fa-tachometer-alt"></h2>
                    </div>
                    
                    <div class="card-body">
                        <div class="voltage-display">
                            <div class="voltage-label" id="voltageLabel">当前锂</div>
                            <input type="number" id="monitorVoltageInput" class="voltage-input" value="7" min="6.0" max="8.5" step="0.01">
                            <div class="chart-result" id="percentageDisplay">电量百分比(%)：</div>
                            <input type="number" id="monitorPercentInput" class="percent-input" value="20" min="0" max="100" step="0.1">
                        </div>
                        
                        <div class="battery-display">
                            <div class="battery-label">估算电量</div>
                            <div id="batteryPercentage" class="battery-percentage battery-medium">50%</div>
                            
                            <div class="battery-visual">
                                <div id="batteryLevel" class="battery-level" style="width: 50%; background: #ff9800;"></div>
                                <div class="battery-cap"></div>
                            </div>
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-header">
                                <span>调整电压值</span>
                                <span id="sliderValue">7.00V</span>
                            </div>
                            
                            <div class="custom-slider">
                                <div class="slider-track">
                                    <div id="sliderProgress" class="slider-progress" style="width: 50%;"></div>
                                    <div id="sliderHandle" class="slider-handle" style="left: 50%;"></div>
                                </div>
                                
                                <div class="slider-marks" id="voltageMarks"></div>
                            </div>
                        </div>
                        
                        <div class="status-bar">
                            <div class="status-item">
                                <div class="status-title">电池型号</div>
                                <div id="batterymodel" class="status-value">C0963B2</div>
                            </div>

                            <div class="status-item">
                                <div class="status-title">工作电压范围</div>
                                <div id="voltageRange" class="status-value">6.3V-8.36V</div>
                            </div>
                            <div class="status-item">
                                <div class="status-title">额定容量</div>
                                <div id="batteryCapacity" class="status-value">5000mah</div>
                            </div>

                            <div class="status-item">
                                <div class="status-title">电池状态</div>
                                <div id="batteryStatus" class="status-value"><span class="status-indicator status-medium"></span>中等电量</div>
                            </div>

                        </div>
                        <div class="voltage-map">
                            <h3>电压-电量对应关系<a id="rawDataLink" class = "raw_data_online" target="_blank" href="https://xiaomi.f.mioffice.cn/sheets/shtk4CJwBHIBF3h7y1YSviKkEAh">(原始数据)</a></h3>
                            <table class="voltage-table" id="voltageTable">
                                <tbody id="voltageTableBody">
                                </tbody>
                            </table>
                        </div>
                        <div id = "batteryfooter" class="footer">
                            电池生产商 © 2025 | 天津聚元（力神）
                        </div>

                    </div>
                </div>

                <!-- 右侧：图表面板 -->
                <div class="card chart-container">
                    <div class="card-header">
                        <h2 id = "chart_title" class="fas fa-chart-line"></h2>
                    </div>
                    <div class="card-body">
                        <div class="chart-wrapper">
                            <canvas id="batteryChart"></canvas>
                            <div id="chartTooltip" class="chart-tooltip"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 图片预览工具提示 -->
    <div id="imageTooltip" class="tooltip">
        <div class="loading">加载图片中...</div>
    </div>

    <script>
        // 扩展电池数据配置，为每个项目添加特定参数
        const batteryConfig = {
            m30: {
                name: "小米智能门锁M30",
                lithium: {
                    voltageLabel: "门锁M30锂",
                    batterymodel: "C0963B2",
                    capicity: "5000mAh",
                    voltagePoints: [6.68, 6.75, 7, 7.11, 7.29 ,7.49 ,7.67, 7.81, 7.94, 8.08, 8.16, 8.36],
                    percentPoints: [3, 5, 15, 20, 30, 40, 50, 60, 70, 80, 90, 100],
                    voltage_percent: [6.25,6.5,6.75,7,7.25,7.5,7.75,8,8.25],
                    percent: [0,10,20,30,40,50,60,70,80,90,100],
                    minVoltage: 6.0,
                    maxVoltage: 8.5,
                    chartVoltages: [6.3,6.472,6.59,6.676,6.724,6.748,6.768,6.79,6.812,6.836,6.864,6.892,6.92,6.948,6.974,7,7.026,7.05,7.072,7.094,7.116,7.138,7.156,7.174,7.192,7.21,7.224,7.24,7.256,7.27,7.288,7.306,7.322,7.34,7.36,7.38,7.4,7.42,7.444,7.468,7.492,7.516,7.536,7.556,7.576,7.596,7.612,7.628,7.644,7.66,7.674,7.688,7.7,7.714,7.728,7.744,7.758,7.772,7.784,7.796,7.806,7.818,7.83,7.84,7.852,7.864,7.876,7.892,7.906,7.92,7.936,7.954,7.97,7.988,8.004,8.02,8.034,8.048,8.06,8.068,8.076,8.084,8.092,8.1,8.106,8.114,8.122,8.13,8.14,8.148,8.158,8.166,8.174,8.182,8.192,8.216,8.24,8.264,8.29,8.326,8.362],
                    chartPercentages:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],
                    footer: "可充电锂离子电池组 © GB 31241-2022 | 制造商：天津聚元新能源科技有限公司",
                    raw_data: "https://xiaomi.f.mioffice.cn/sheets/shtk4CJwBHIBF3h7y1YSviKkEAh"
                },
                dry: {
                    voltageLabel: "门锁M30干",
                    batterymodel: "5号米家碱性电池",
                    capicity: "1.5V*4",
                    voltagePoints: [4.76,4.81,5.01,5.08,5.2,5.28,5.36,5.46,5.58,5.70,5.86,6.32],
                    percentPoints: [3, 5, 15, 20, 30, 40, 50, 60, 70, 80, 90, 100],
                    voltage_percent: [4.7,4.9,5.1,5.3,5.5,5.7,5.9,6.1,6.3],
                    percent: [0,10,20,30,40,50,60,70,80,90,100],
                    minVoltage: 4.5,
                    maxVoltage: 6.5,
                    chartVoltages: [4.72,4.742,4.765,4.788,4.811,4.834,4.857,4.88,4.899,4.919,4.938,4.958,4.977,4.997,5.016,5.036,5.048,5.061,5.074,5.087,5.1,5.113,5.126,5.139,5.152,5.163,5.174,5.185,5.196,5.207,5.218,5.229,5.24,5.247,5.254,5.261,5.268,5.275,5.282,5.289,5.296,5.304,5.311,5.318,5.325,5.332,5.339,5.346,5.353,5.36,5.37,5.38,5.39,5.4,5.41,5.42,5.43,5.44,5.451,5.463,5.474,5.486,5.497,5.509,5.52,5.532,5.546,5.56,5.574,5.588,5.603,5.617,5.631,5.645,5.66,5.669,5.678,5.687,5.696,5.705,5.714,5.723,5.732,5.75,5.769,5.788,5.806,5.825,5.844,5.862,5.881,5.9,5.952,6.005,6.057,6.11,6.162,6.215,6.267,6.32],
                    chartPercentages: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100],
                    footer: "米家碱性电池 © GB/T 8897.2 | 制造商：宁波金山双鹿电池有限公司",
                    raw_data: "https://xiaomi.f.mioffice.cn/sheets/shtk4CJwBHIBF3h7y1YSviKkEAh"
                }
            },

            m4prodan: {
                name: "小米智能门锁4 Pro(单摄)",
                lithium: {
                    voltageLabel: "门锁4pro(单摄)锂",
                    batterymodel: "C0963B2",
                    capicity: "5000mAh",
                    voltagePoints: [6.68, 6.75, 7, 7.11, 7.29 ,7.49 ,7.67, 7.81, 7.94, 8.08, 8.16, 8.36],
                    percentPoints: [3, 5, 15, 20, 30, 40, 50, 60, 70, 80, 90, 100],
                    voltage_percent: [6.25,6.5,6.75,7,7.25,7.5,7.75,8,8.25],
                    percent: [0,10,20,30,40,50,60,70,80,90,100],
                    minVoltage: 6.0,
                    maxVoltage: 8.5,
                    chartVoltages: [6.3,6.472,6.59,6.676,6.724,6.748,6.768,6.79,6.812,6.836,6.864,6.892,6.92,6.948,6.974,7,7.026,7.05,7.072,7.094,7.116,7.138,7.156,7.174,7.192,7.21,7.224,7.24,7.256,7.27,7.288,7.306,7.322,7.34,7.36,7.38,7.4,7.42,7.444,7.468,7.492,7.516,7.536,7.556,7.576,7.596,7.612,7.628,7.644,7.66,7.674,7.688,7.7,7.714,7.728,7.744,7.758,7.772,7.784,7.796,7.806,7.818,7.83,7.84,7.852,7.864,7.876,7.892,7.906,7.92,7.936,7.954,7.97,7.988,8.004,8.02,8.034,8.048,8.06,8.068,8.076,8.084,8.092,8.1,8.106,8.114,8.122,8.13,8.14,8.148,8.158,8.166,8.174,8.182,8.192,8.216,8.24,8.264,8.29,8.326,8.362],
                    chartPercentages:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],
                    footer: "可充电锂离子电池组 © GB 31241-2022 | 制造商：天津聚元新能源科技有限公司",
                    raw_data: "https://xiaomi.f.mioffice.cn/sheets/shtk4CJwBHIBF3h7y1YSviKkEAh"
                },
                dry: {
                    voltageLabel: "门锁4pro(单摄)干",
                    batterymodel: "5号米家碱性电池",
                    capicity: "1.5V*4",
                    voltagePoints: [4.76,4.81,5.01,5.08,5.2,5.28,5.36,5.46,5.58,5.70,5.86,6.32],
                    percentPoints: [3, 5, 15, 20, 30, 40, 50, 60, 70, 80, 90, 100],
                    voltage_percent: [4.7,4.9,5.1,5.3,5.5,5.7,5.9,6.1,6.3],
                    percent: [0,10,20,30,40,50,60,70,80,90,100],
                    minVoltage: 4.5,
                    maxVoltage: 6.5,
                    chartVoltages: [4.72,4.742,4.765,4.788,4.811,4.834,4.857,4.88,4.899,4.919,4.938,4.958,4.977,4.997,5.016,5.036,5.048,5.061,5.074,5.087,5.1,5.113,5.126,5.139,5.152,5.163,5.174,5.185,5.196,5.207,5.218,5.229,5.24,5.247,5.254,5.261,5.268,5.275,5.282,5.289,5.296,5.304,5.311,5.318,5.325,5.332,5.339,5.346,5.353,5.36,5.37,5.38,5.39,5.4,5.41,5.42,5.43,5.44,5.451,5.463,5.474,5.486,5.497,5.509,5.52,5.532,5.546,5.56,5.574,5.588,5.603,5.617,5.631,5.645,5.66,5.669,5.678,5.687,5.696,5.705,5.714,5.723,5.732,5.75,5.769,5.788,5.806,5.825,5.844,5.862,5.881,5.9,5.952,6.005,6.057,6.11,6.162,6.215,6.267,6.32],
                    chartPercentages: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100],
                    footer: "米家碱性电池 © GB/T 8897.2 | 制造商：宁波金山双鹿电池有限公司",
                    raw_data: "https://xiaomi.f.mioffice.cn/sheets/shtk4CJwBHIBF3h7y1YSviKkEAh"
                }
            },

            m4proshuang: {
                name: "小米智能门锁4 Pro(双摄)",
                lithium: {
                    voltageLabel: "门锁4pro(双摄)锂",
                    batterymodel: "C0963B1",
                    capicity: "6870mAh",
                    voltagePoints: [7.22, 7.36, 7.46, 7.51, 7.58, 7.65, 7.75, 7.93, 8.13, 8.34, 8.58, 8.81],
                    percentPoints: [3, 5, 15, 20, 30, 40, 50, 60, 70, 80, 90, 100],
                    voltage_percent: [6.3,6.6,6.9,7.2,7.5,7.8,8.1,8.4,8.7],
                    percent: [0,10,20,30,40,50,60,70,80,90,100],
                    minVoltage: 6,
                    maxVoltage: 9,
                    chartVoltages: [6.34,6.92,7.102,7.224,7.314,7.364,7.38,7.388,7.394,7.402,7.41,7.418,7.426,7.434,7.444,7.456,7.47,7.482,7.494,7.504,7.514,7.524,7.532,7.54,7.546,7.552,7.558,7.562,7.568,7.572,7.578,7.584,7.59,7.596,7.602,7.608,7.616,7.622,7.628,7.638,7.646,7.654,7.662,7.672,7.68,7.69,7.7,7.71,7.722,7.734,7.746,7.762,7.778,7.794,7.812,7.832,7.852,7.872,7.892,7.912,7.93,7.95,7.968,7.986,8.004,8.024,8.042,8.062,8.084,8.104,8.126,8.146,8.166,8.186,8.208,8.23,8.252,8.274,8.296,8.32,8.344,8.366,8.39,8.414,8.438,8.462,8.486,8.51,8.534,8.558,8.582,8.604,8.626,8.648,8.67,8.692,8.712,8.734,8.754,8.782,8.812],
                    chartPercentages: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100],
                    footer: "可充电锂离子电池组 © GB 31241-2022 | 制造商：广东力科新能源有限公司",
                    raw_data: "https://xiaomi.f.mioffice.cn/sheets/shtk4ZI0PK6knlWO1JDKd6LU6We"
                },
                dry: {
                    voltageLabel: "门锁4pro(双摄)干",
                    batterymodel: "5号米家碱性电池",
                    capicity: "1.5V*4",
                    voltagePoints: [4.76,4.81,5.01,5.08,5.2,5.28,5.36,5.46,5.58,5.70,5.86,6.32],
                    percentPoints: [3, 5, 15, 20, 30, 40, 50, 60, 70, 80, 90, 100],
                    voltage_percent: [4.7,4.9,5.1,5.3,5.5,5.7,5.9,6.1,6.3],
                    percent: [0,10,20,30,40,50,60,70,80,90,100],
                    minVoltage: 4.5,
                    maxVoltage: 6.5,
                    chartVoltages: [4.72,4.742,4.765,4.788,4.811,4.834,4.857,4.88,4.899,4.919,4.938,4.958,4.977,4.997,5.016,5.036,5.048,5.061,5.074,5.087,5.1,5.113,5.126,5.139,5.152,5.163,5.174,5.185,5.196,5.207,5.218,5.229,5.24,5.247,5.254,5.261,5.268,5.275,5.282,5.289,5.296,5.304,5.311,5.318,5.325,5.332,5.339,5.346,5.353,5.36,5.37,5.38,5.39,5.4,5.41,5.42,5.43,5.44,5.451,5.463,5.474,5.486,5.497,5.509,5.52,5.532,5.546,5.56,5.574,5.588,5.603,5.617,5.631,5.645,5.66,5.669,5.678,5.687,5.696,5.705,5.714,5.723,5.732,5.75,5.769,5.788,5.806,5.825,5.844,5.862,5.881,5.9,5.952,6.005,6.057,6.11,6.162,6.215,6.267,6.32],
                    chartPercentages: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100],
                    footer: "米家碱性电池 © GB/T 8897.2 | 制造商：宁波金山双鹿电池有限公司",
                    raw_data: "https://xiaomi.f.mioffice.cn/sheets/shtk4ZI0PK6knlWO1JDKd6LU6We"
                }
            },


            m40: {
                name: "小米智能门锁M40",
                lithium: {
                    voltageLabel: "门锁M40锂",
                    batterymodel: "JY745490",
                    capicity: "8000mAh",
                    voltagePoints: [7.22, 7.36, 7.46, 7.52, 7.58, 7.64, 7.72, 7.9, 8.06, 8.27, 8.5, 8.76],
                    percentPoints: [3, 5, 15, 20, 30, 40, 50, 60, 70, 80, 90, 100],
                    voltage_percent: [6.3,6.6,6.9,7.2,7.5,7.8,8.1,8.4,8.7],
                    percent: [0,10,20,30,40,50,60,70,80,90,100],
                    minVoltage: 6,
                    maxVoltage: 9,
                    chartVoltages: [6.3,6.912,7.098,7.222,7.312,7.364,7.382,7.388,7.396,7.404,7.412,7.42,7.428,7.436,7.446,7.46,7.472,7.486,7.498,7.508,7.518,7.528,7.536,7.542,7.55,7.556,7.562,7.566,7.572,7.576,7.582,7.586,7.592,7.596,7.602,7.606,7.612,7.616,7.622,7.63,7.636,7.644,7.65,7.658,7.66,7.674,7.682,7.692,7.702,7.712,7.724,7.738,7.752,7.766,7.784,7.804,7.826,7.848,7.87,7.884,7.9,7.916,7.932,7.948,7.964,7.98,7.996,8.014,8.03,8.048,8.064,8.084,8.104,8.124,8.142,8.164,8.184,8.204,8.224,8.246,8.268,8.29,8.312,8.334,8.356,8.38,8.402,8.426,8.448,8.472,8.496,8.518,8.542,8.566,8.588,8.616,8.642,8.668,8.694,8.726,8.756],
                    chartPercentages: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],
                    footer: "可充电锂离子电池组 © GB 31241-2022 | 制造商：广东力科新能源有限公司",
                    raw_data: "https://xiaomi.f.mioffice.cn/sheets/shtk4RpYaMETy1aVCkU7VjiCgHg"
                },

                dry: {
                    voltageLabel: "门锁M40干",
                    batterymodel: "5号米家碱性电池",
                    capicity: "1.5V*4",
                    voltagePoints: [4.76,4.81,5.01,5.08,5.2,5.28,5.36,5.46,5.58,5.70,5.86,6.32],
                    percentPoints: [3, 5, 15, 20, 30, 40, 50, 60, 70, 80, 90, 100],
                    voltage_percent: [4.7,4.9,5.1,5.3,5.5,5.7,5.9,6.1,6.3],
                    percent: [0,10,20,30,40,50,60,70,80,90,100],
                    minVoltage: 4.5,
                    maxVoltage: 6.5,
                    chartVoltages: [4.72,4.742,4.765,4.788,4.811,4.834,4.857,4.88,4.899,4.919,4.938,4.958,4.977,4.997,5.016,5.036,5.048,5.061,5.074,5.087,5.1,5.113,5.126,5.139,5.152,5.163,5.174,5.185,5.196,5.207,5.218,5.229,5.24,5.247,5.254,5.261,5.268,5.275,5.282,5.289,5.296,5.304,5.311,5.318,5.325,5.332,5.339,5.346,5.353,5.36,5.37,5.38,5.39,5.4,5.41,5.42,5.43,5.44,5.451,5.463,5.474,5.486,5.497,5.509,5.52,5.532,5.546,5.56,5.574,5.588,5.603,5.617,5.631,5.645,5.66,5.669,5.678,5.687,5.696,5.705,5.714,5.723,5.732,5.75,5.769,5.788,5.806,5.825,5.844,5.862,5.881,5.9,5.952,6.005,6.057,6.11,6.162,6.215,6.267,6.32],
                    chartPercentages: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100],
                    footer: "米家碱性电池 © GB/T 8897.2 | 制造商：宁波金山双鹿电池有限公司",
                    raw_data: "https://xiaomi.f.mioffice.cn/sheets/shtk4RpYaMETy1aVCkU7VjiCgHg"
                }
            },
            m5max: {
                name: "小米智能门锁5 MAX全景鱼眼",
                lithium: {
                    voltageLabel: "门锁5max上锂",
                    batterymodel: "JY745490",
                    capicity: "8000mAh",
                    voltagePoints: [7.22, 7.36, 7.46, 7.52, 7.58, 7.64, 7.72, 7.9, 8.06, 8.27, 8.5, 8.76],
                    percentPoints: [3, 5, 15, 20, 30, 40, 50, 60, 70, 80, 90, 100],
                    voltage_percent: [6.3,6.6,6.9,7.2,7.5,7.8,8.1,8.4,8.7],
                    percent: [0,10,20,30,40,50,60,70,80,90,100],
                    minVoltage: 6,
                    maxVoltage: 9,
                    chartVoltages: [6.3,6.912,7.098,7.222,7.312,7.364,7.382,7.388,7.396,7.404,7.412,7.42,7.428,7.436,7.446,7.46,7.472,7.486,7.498,7.508,7.518,7.528,7.536,7.542,7.55,7.556,7.562,7.566,7.572,7.576,7.582,7.586,7.592,7.596,7.602,7.606,7.612,7.616,7.622,7.63,7.636,7.644,7.65,7.658,7.66,7.674,7.682,7.692,7.702,7.712,7.724,7.738,7.752,7.766,7.784,7.804,7.826,7.848,7.87,7.884,7.9,7.916,7.932,7.948,7.964,7.98,7.996,8.014,8.03,8.048,8.064,8.084,8.104,8.124,8.142,8.164,8.184,8.204,8.224,8.246,8.268,8.29,8.312,8.334,8.356,8.38,8.402,8.426,8.448,8.472,8.496,8.518,8.542,8.566,8.588,8.616,8.642,8.668,8.694,8.726,8.756],
                    chartPercentages: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],
                    footer: "可充电锂离子电池组 © GB 31241-2022 | 制造商：广东力科新能源有限公司",
                    raw_data: "https://xiaomi.f.mioffice.cn/sheets/shtk4RpYaMETy1aVCkU7VjiCgHg"
                },

                dry: {
                    voltageLabel: "门锁5max下锂",
                    batterymodel: "JY745490",
                    capicity: "8000mAh",
                    voltagePoints: [7.22, 7.36, 7.46, 7.52, 7.58, 7.64, 7.72, 7.9, 8.06, 8.27, 8.5, 8.76],
                    percentPoints: [3, 5, 15, 20, 30, 40, 50, 60, 70, 80, 90, 100],
                    voltage_percent: [6.3,6.6,6.9,7.2,7.5,7.8,8.1,8.4,8.7],
                    percent: [0,10,20,30,40,50,60,70,80,90,100],
                    minVoltage: 6,
                    maxVoltage: 9,
                    chartVoltages: [6.3,6.912,7.098,7.222,7.312,7.364,7.382,7.388,7.396,7.404,7.412,7.42,7.428,7.436,7.446,7.46,7.472,7.486,7.498,7.508,7.518,7.528,7.536,7.542,7.55,7.556,7.562,7.566,7.572,7.576,7.582,7.586,7.592,7.596,7.602,7.606,7.612,7.616,7.622,7.63,7.636,7.644,7.65,7.658,7.66,7.674,7.682,7.692,7.702,7.712,7.724,7.738,7.752,7.766,7.784,7.804,7.826,7.848,7.87,7.884,7.9,7.916,7.932,7.948,7.964,7.98,7.996,8.014,8.03,8.048,8.064,8.084,8.104,8.124,8.142,8.164,8.184,8.204,8.224,8.246,8.268,8.29,8.312,8.334,8.356,8.38,8.402,8.426,8.448,8.472,8.496,8.518,8.542,8.566,8.588,8.616,8.642,8.668,8.694,8.726,8.756],
                    chartPercentages: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],
                    footer: "可充电锂离子电池组 © GB 31241-2022 | 制造商：广东力科新能源有限公司",
                    raw_data: "https://xiaomi.f.mioffice.cn/sheets/shtk4RpYaMETy1aVCkU7VjiCgHg"
                }
            },



        };
        
        let currentProject = "m4prodan"; // 默认设置为M30
        let currentBatteryType = "lithium";
        let chart = null;
        
        // DOM 元素
        const voltageLabel = document.getElementById('voltageLabel');
        const batterymodel = document.getElementById('batterymodel');
        const voltageRange = document.getElementById('voltageRange');
        const capicity = document.getElementById('batteryCapacity');
        const chart_title = document.getElementById('chart_title');
        const monitor_title = document.getElementById('monitor_title');
        const voltageTableBody = document.getElementById('voltageTableBody');
        const lithiumButton = document.getElementById('lithiumButton');
        const dryCellButton = document.getElementById('dryCellButton');
        const batteryfooter = document.getElementById('batteryfooter');
        const sliderHandle = document.getElementById('sliderHandle');
        const monitorPercentInput = document.getElementById('monitorPercentInput');
        const chartTooltip = document.getElementById('chartTooltip');
        const projectItems = document.querySelectorAll('.project-item');
        const rawDataLink = document.getElementById('rawDataLink');
        const imageTooltip = document.getElementById('imageTooltip');



        // 图片预览功能优化
        function initImagePreview() {
            const batteryModelElements = [

                {id: 'batteryModel1Pic', src: './/pictures//JY745490_5000mAh.jpg'},
                {id: 'batteryModel2Pic', src: './/pictures//C0963B1_6870mAh.jpg'},
                {id: 'batteryModel3Pic', src: './/pictures//C0963B2_8000mAh.jpg'}
            ];

            batteryModelElements.forEach(item => {
                const element = document.getElementById(item.id);
                if (!element) return;

                let tooltipTimeout;
                let currentImg = null;
                let elementRect = null; // 每个元素独立的 rect

                // 鼠标悬停处理
                element.addEventListener('mouseenter', function(e) {
                    // 保存当前元素位置
                    elementRect = this.getBoundingClientRect();

                    tooltipTimeout = setTimeout(() => {
                        currentImg = new Image();
                        currentImg.src = item.src;

                        currentImg.onload = () => {
                            imageTooltip.innerHTML = '';
                            imageTooltip.appendChild(currentImg);
                            positionTooltip(e, elementRect); // 传入 elementRect
                            imageTooltip.classList.add('active');
                        };

                        currentImg.onerror = () => {
                            imageTooltip.innerHTML = '<div class="loading">图片加载失败</div>';
                            positionTooltip(e, elementRect);
                            imageTooltip.classList.add('active');
                        };
                    }, 300);
                });

                // 鼠标移动时更新位置
                element.addEventListener('mousemove', function(e) {
                    if (imageTooltip.classList.contains('active')) {
                        positionTooltip(e, elementRect);
                    }
                });

                // 鼠标离开时清除
                element.addEventListener('mouseleave', function() {
                    clearTimeout(tooltipTimeout);
                    hideTooltip();
                    elementRect = null; // 清除 rect
                });
            });
        }





        // 定位tooltip
        function positionTooltip(e, rect) {
            const tooltip = imageTooltip;

            // 如果 rect 不存在，使用事件目标的 rect
            if (!rect) {
                rect = e.target.getBoundingClientRect();
            }

            // 计算基础位置
            let left = rect.left + rect.width + 10;
            let top = rect.top + rect.height*2  - (tooltip.offsetHeight / 2);

            // 检查右侧空间
            if (left + tooltip.offsetWidth > window.innerWidth) {
                left = rect.left - tooltip.offsetWidth - 20;
            }
            
            if (top<0){
                top = 10
            } 



            tooltip.style.left = `${left}px`;
            tooltip.style.top = `${top}px`;
        }




        // 页面加载完成后初始化
        window.addEventListener('DOMContentLoaded', () => {
            init();
            initImagePreview(); // 新增初始化调用
        });


        // 显示提示框
        function showTooltip(imageUrl, e) {
            // 创建图片并加载
            const img = new Image();
            img.onload = function() {
                imageTooltip.innerHTML = '';
                imageTooltip.appendChild(img);
            };
            
            img.onerror = function() {
                imageTooltip.innerHTML = '<div class="loading">图片加载失败</div>';
            };
            
            img.src = imageUrl;
            img.alt = '电池型号图片';
            
            // 激活提示框
            imageTooltip.classList.add('active');
            positionTooltip(e);
        }
        
   
        // 隐藏提示框
        function hideTooltip() {
            imageTooltip.classList.remove('active');
        }


        // 将电量百分比转换为电压值
        function percentageToVoltage(percentage, data) {
            // 检查边界值
            if (percentage <= 0) return data.chartVoltages[0];
            if (percentage >= 100) return data.chartVoltages[data.chartVoltages.length - 1];
            
            // 查找百分比所在的区间
            for (let i = 0; i < data.chartPercentages.length - 1; i++) {
                if (percentage >= data.chartPercentages[i] && percentage < data.chartPercentages[i + 1]) {
                    // 线性插值计算
                    const lowPercent = data.chartPercentages[i];
                    const highPercent = data.chartPercentages[i + 1];
                    const lowVoltage = data.chartVoltages[i];
                    const highVoltage = data.chartVoltages[i + 1];
                    
                    const ratio = (percentage - lowPercent) / (highPercent - lowPercent);
                    return lowVoltage + ratio * (highVoltage - lowVoltage);
                }
            }
            
            return data.chartVoltages[0]; // 默认值
        }
        
        // 将电压转换为电量百分比（带线性插值）
        function voltageToPercentage(voltage, data) {
            // 检查边界值
            if (voltage <= data.chartVoltages[0]) return data.chartPercentages[0];
            if (voltage >= data.chartVoltages[data.chartVoltages.length - 1]) 
                return data.chartPercentages[data.chartPercentages.length - 1];
            
            // 查找电压所在的区间
            for (let i = 0; i < data.chartVoltages.length - 1; i++) {
                if (voltage >= data.chartVoltages[i] && voltage < data.chartVoltages[i + 1]) {
                    // 线性插值计算
                    const lowVoltage = data.chartVoltages[i];
                    const highVoltage = data.chartVoltages[i + 1];
                    const lowPercent = data.chartPercentages[i];
                    const highPercent = data.chartPercentages[i + 1];
                    
                    const ratio = (voltage - lowVoltage) / (highVoltage - lowVoltage);
                    return lowPercent + ratio * (highPercent - lowPercent);
                }
            }
            
            return 0; // 默认值
        }
        
        // 初始化电压表
        function initVoltageTable(data) {
            voltageTableBody.innerHTML = '';
  
            // 创建电压数据行
            const voltageRow = document.createElement('tr');
            voltageRow.innerHTML = `
                <th>电压/V</th>
                ${data.voltagePoints.map(point => `<td>${point}</td>`).join('')}
            `;
            voltageTableBody.appendChild(voltageRow);
            
            // 创建百分比数据行
            const percentRow = document.createElement('tr');
            percentRow.innerHTML = `
                <th>电量/%</th>
                ${data.percentPoints.map(percent => `<td>${percent}</td>`).join('')}
            `;
            voltageTableBody.appendChild(percentRow);
        }
        
        // 初始化电压标记
        function initVoltageMarks(data) {
            const voltageMarks = document.getElementById('voltageMarks');
            voltageMarks.innerHTML = '';
            
            const minVoltage = data.minVoltage;
            const maxVoltage = data.maxVoltage;
            
            data.voltage_percent.forEach(voltage_percent => {
                const mark = document.createElement('div');
                mark.className = 'slider-mark';
                
                // 计算标记点的位置百分比
                const position = ((voltage_percent - minVoltage) / (maxVoltage - minVoltage)) * 100;
                mark.style.left = position + '%';
                
                const line = document.createElement('div');
                line.className = 'mark-line';
                
                const text = document.createElement('div');
                text.textContent = voltage_percent.toFixed(2) + 'V';
                
                mark.appendChild(line);
                mark.appendChild(text);
                voltageMarks.appendChild(mark);
            });
        }
        
        // 更新UI显示
        function updateUI(voltage) {
            const data = batteryConfig[currentProject][currentBatteryType];
            
            // 计算电量百分比
            const percentage = voltageToPercentage(voltage, data);
            
            // 更新电量显示
            batteryPercentage.textContent = percentage.toFixed(1) + '%';

            // 更新原始数据链接
            rawDataLink.href = data.raw_data;
            
            // 更新电池状态和颜色
            let status, color, batteryClass, indicatorClass;
            if (percentage <= 10) {
                status = "低电量警告";
                color = "#d32f2f";
                batteryClass = "battery-low";
                indicatorClass = "status-low";
            } else if ( percentage>10 && percentage < 60) {
                status = "中等电量";
                color = "#f59e0b";
                batteryClass = "battery-medium";
                indicatorClass = "status-medium";
            } else {
                status = "电量充足";
                color = "#2e7d32";
                batteryClass = "battery-high";
                indicatorClass = "status-high";
            }
            
            batteryPercentage.className = "battery-percentage " + batteryClass;
            batteryStatus.innerHTML = `<span class="status-indicator ${indicatorClass}"></span>${status}`;
            
            // 更新电池可视化
            batteryLevel.style.width = percentage + '%';
            batteryLevel.style.backgroundColor = color;
            
            // 更新滑块显示
            sliderValue.textContent = voltage.toFixed(2) + 'V';
            
            // 计算滑块位置 (电压从min到max)
            const minVoltage = data.minVoltage;
            const maxVoltage = data.maxVoltage;
            const position = ((voltage - minVoltage) / (maxVoltage - minVoltage)) * 100;
            
            sliderHandle.style.left = position + '%';
            sliderProgress.style.width = position + '%';
            
            // 更新百分比输入框（避免触发循环更新）
            if (Math.abs(parseFloat(monitorPercentInput.value) - percentage) > 0.1) {
                monitorPercentInput.value = percentage.toFixed(1);
            }
            
            // 更新图表上的标记点
            if (chart) {
                chart.data.datasets[0].pointBackgroundColor = data.chartVoltages.map((v, i) => 
                    Math.abs(v - voltage) < 0.01 ? '#dc2626' : '#1e40af'
                );
                chart.update();
            }
        }
        
        // 从百分比更新电压和UI
        function updateFromPercentage(percentage) {
            const data = batteryConfig[currentProject][currentBatteryType];
            const voltage = percentageToVoltage(percentage, data);
            
            // 更新电压输入框（避免触发循环更新）
            if (Math.abs(parseFloat(document.getElementById('monitorVoltageInput').value) - voltage) > 0.01) {
                document.getElementById('monitorVoltageInput').value = voltage.toFixed(2);
            }
            
            // 更新UI
            updateUI(voltage);
        }
        
        // 初始化图表
        function initChart(data) {
            const ctx = document.getElementById('batteryChart').getContext('2d');
            
            // 销毁现有图表
            if (chart) {
                chart.destroy();
            }
            
            // 创建新图表
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: '电量百分比',
                        data: data.chartVoltages.map((v, i) => ({x: v, y: data.chartPercentages[i]})),
                        borderColor: '#1e40af',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: data.chartVoltages.map(v => '#1e40af'),
                        pointBorderColor: '#fff',
                        pointHoverRadius: 6,
                        pointRadius: 4,
                        pointBorderWidth: 2,
                        fill: true,
                        tension: 0.2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            title: {
                                display: true,
                                text: '电压 (V)',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                color: '#1e40af'
                            },
                            min: data.minVoltage,
                            max: data.maxVoltage,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                font: {
                                    size: 14
                                }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '电量 (%)',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                color: '#1e40af'
                            },
                            min: 0,
                            max: 100,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            backgroundColor: 'rgba(30, 30, 30, 0.85)',
                            titleFont: {
                                size: 16
                            },
                            bodyFont: {
                                size: 14
                            },
                            padding: 12,
                            callbacks: {
                                label: (context) => `电量: ${context.parsed.y.toFixed(1)}%`,
                                title: (context) => `电压: ${context[0].parsed.x.toFixed(3)}V`
                            }
                        },
                        legend: {
                            display: false
                        },
                        title: {
                            display: false
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
            
            // 添加鼠标移动事件监听
            const canvas = document.getElementById('batteryChart');
            
            canvas.addEventListener('mousemove', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // 获取鼠标位置对应的电压值
                const xScale = chart.scales.x;
                const voltage = xScale.getValueForPixel(x);
                
                // 确保电压在范围内
                if (voltage < data.chartVoltages[0] || voltage > data.chartVoltages[data.chartVoltages.length-1]) {
                    chartTooltip.style.display = 'none';
                    return;
                }
                
                // 计算对应的电量百分比
                const percentage = voltageToPercentage(voltage, data);
                
                // 更新工具提示内容
                chartTooltip.innerHTML = `电压: ${voltage.toFixed(2)}V<br>电量: ${percentage.toFixed(1)}%`;
                
                // 定位工具提示
                chartTooltip.style.left = (x + rect.left + 10) + 'px';
                chartTooltip.style.top = (y + rect.top - 10) + 'px';
                chartTooltip.style.display = 'block';
            });
            
            canvas.addEventListener('mouseout', () => {
                chartTooltip.style.display = 'none';
            });
        }
        
        // 初始化页面
        function initBatterySystem(project, type) {
            currentProject = project;
            currentBatteryType = type;
            const data = batteryConfig[project][type];
            
            // 更新UI文本
            voltageLabel.textContent = `${data.voltageLabel}电池电压(V)：`;
            voltageRange.textContent = `${data.chartVoltages[0].toFixed(2)}V - ${data.chartVoltages[data.chartVoltages.length-1].toFixed(2)}V`;
            capicity.textContent = data.capicity;
            batterymodel.textContent = data.batterymodel;
            batteryfooter.textContent = data.footer;

            monitor_title.textContent = `${data.voltageLabel}电池状态监控`;
            chart_title.textContent = `${data.voltageLabel}电池电压-电量关系曲线`;
            


            // 更新按钮状态
            if (type === "lithium") {
                lithiumButton.classList.add('active');
                dryCellButton.classList.remove('active');
            } 
            if (type === "dry") {
                dryCellButton.classList.add('active');
                lithiumButton.classList.remove('active');
            }
            
            if (project === "m5max") {
                lithiumButton.textContent = `上锂电`
                dryCellButton.textContent = `下锂电`
            }else{
                lithiumButton.textContent = `锂电池`
                dryCellButton.textContent = `干电池`

            }




            // 初始化组件
            initVoltageTable(data);
            initVoltageMarks(data);
            initChart(data);
            
            // 设置输入框范围
            const input = document.getElementById('monitorVoltageInput');
            input.min = data.minVoltage;
            input.max = data.maxVoltage;
            
            // 设置初始电压为20%电量对应的电压
            const initialVoltage = percentageToVoltage(20, data);
            input.value = initialVoltage.toFixed(2);
            
            // 更新UI
            updateUI(initialVoltage);
        }
        
        // 初始化页面
        function init() {
            // 设置初始电池类型
            initBatterySystem("m4prodan", "lithium");
            
            // 项目选择事件
            projectItems.forEach(item => {
                item.addEventListener('click', function() {
                    // 移除所有active类
                    projectItems.forEach(i => i.classList.remove('active'));
                    // 添加当前active类
                    this.classList.add('active');
                    
                    // 获取项目ID
                    const projectId = this.getAttribute('data-project');
                    // 重新初始化电池系统
                    initBatterySystem(projectId, currentBatteryType);
                });
            });
            
            // 输入框事件监听
            const voltageInput = document.getElementById('monitorVoltageInput');
            voltageInput.addEventListener('input', function() {
                let voltage = parseFloat(this.value);
                
                // 确保在范围内
                const data = batteryConfig[currentProject][currentBatteryType];
                if (voltage < data.minVoltage) voltage = data.minVoltage;
                if (voltage > data.maxVoltage) voltage = data.maxVoltage;
                
                // this.value = voltage.toFixed(2);
                updateUI(voltage);
            });
            
            // 百分比输入框事件监听
            monitorPercentInput.addEventListener('input', function() {
                let percentage = parseFloat(this.value);
                
                // 确保在范围内
                if (percentage < 0) percentage = 0;
                if (percentage > 100) percentage = 100;
                
                // this.value = percentage.toFixed(1);
                updateFromPercentage(percentage);
            });
            
            // 滑块事件监听
            let isDragging = false;
            const sliderHandle = document.getElementById('sliderHandle');
            
            sliderHandle.addEventListener('mousedown', function(e) {
                isDragging = true;
                document.body.style.cursor = 'grabbing';
                sliderHandle.classList.add('dragging');
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isDragging) return;
                
                const slider = document.querySelector('.slider-track');
                const rect = slider.getBoundingClientRect();
                let position = ((e.clientX - rect.left) / rect.width) * 100;
                
                // 限制在0-100%
                if (position < 0) position = 0;
                if (position > 100) position = 100;
                
                // 计算电压值
                const data = batteryConfig[currentProject][currentBatteryType];
                const voltage = data.minVoltage + (position / 100) * (data.maxVoltage - data.minVoltage);
                
                // 更新输入框和UI
                voltageInput.value = voltage.toFixed(2);
                updateUI(voltage);
            });
            
            document.addEventListener('mouseup', function() {
                isDragging = false;
                document.body.style.cursor = 'default';
                sliderHandle.classList.remove('dragging');
            });
            
            // 点击滑块轨道的事件
            const sliderTrack = document.querySelector('.slider-track');
            sliderTrack.addEventListener('click', function(e) {
                const rect = this.getBoundingClientRect();
                const position = ((e.clientX - rect.left) / rect.width) * 100;
                
                // 计算电压值
                const data = batteryConfig[currentProject][currentBatteryType];
                const voltage = data.minVoltage + (position / 100) * (data.maxVoltage - data.minVoltage);
                
                // 更新输入框和UI
                voltageInput.value = voltage.toFixed(2);
                updateUI(voltage);
            });
            
            // 电池类型切换按钮事件
            lithiumButton.addEventListener('click', () => initBatterySystem(currentProject, "lithium"));
            dryCellButton.addEventListener('click', () => initBatterySystem(currentProject, "dry"));
        }
        
        // 页面加载完成后初始化
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>
